<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ description or 'Saramonse Beauty' }}">
    <title>{{ title }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&family=Jost:wght@300;400;500;600&family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/styles.css">
</head>
<body class="font-serif text-gray-800">
    {% set navTheme = "light" %}
    {% set navVariant = "compact" %}
    {% set navId = "nav-main" %}
    {% set navBg = "nav-fade-light" %}
    {% set navExtraClasses = "transition-all duration-500 ease-in-out opacity-100 translate-y-0" %}
    {% include "navigation.njk" %}

    {% if scrollCompactNav %}
    {% set navTheme = "dark" %}
    {% set navVariant = "compact" %}
    {% set navId = "nav-compact" %}
    {% set navBg = "bg-black/80 backdrop-blur-md" %}
    {% set navExtraClasses = "transition-all duration-500 ease-in-out opacity-0 -translate-y-full pointer-events-none" %}
    {% include "navigation.njk" %}
    {% endif %}

    <main class="pt-20 lg:pt-24">
        {{ content | safe }}
    </main>

    {% include "footer.njk" %}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var mobileMenuBtns = document.querySelectorAll('.mobile-menu-btn');
            var overlay = document.getElementById('mobile-menu');
            if (!overlay) return;

            var EASE = 'cubic-bezier(0.77, 0, 0.175, 1)';

            // Set clip-path via inline style with -webkit- prefix for Safari.
            function setClipPath(val) {
                overlay.style.webkitClipPath = val;
                overlay.style.clipPath = val;
            }

            // Set the clip-path CSS transition (or 'none' to disable).
            function setTransition(duration) {
                var t = duration
                    ? '-webkit-clip-path ' + duration + ' ' + EASE + ', clip-path ' + duration + ' ' + EASE
                    : 'none';
                overlay.style.webkitTransition = t;
                overlay.style.transition = t;
            }

            function openMenu(btn) {
                var rect = btn.getBoundingClientRect();
                var ox = Math.round(rect.left + rect.width / 2);
                var oy = Math.round(rect.top + rect.height / 2);

                // Make element visible before animating â€” Safari does not reliably
                // hide/show position:fixed elements with clip-path alone.
                overlay.style.display = 'block';

                // Snap to closed state at the button's position with no transition.
                setTransition(null);
                setClipPath('circle(0% at ' + ox + 'px ' + oy + 'px)');

                // Force a reflow so the "no transition" state commits before animating.
                overlay.getBoundingClientRect(); // eslint-disable-line no-unused-expressions

                // Animate burst open.
                setTransition('0.65s');
                setClipPath('circle(150% at ' + ox + 'px ' + oy + 'px)');

                overlay.classList.remove('menu-closing');
                overlay.classList.add('menu-open');
                mobileMenuBtns.forEach(function (b) { b.classList.add('menu-open'); });

                // iOS Safari ignores overflow:hidden on <html>/<body>; use position:fixed.
                var sy = window.scrollY !== undefined ? window.scrollY : window.pageYOffset;
                document.body.dataset.menuScrollY = sy;
                document.body.style.position = 'fixed';
                document.body.style.top = '-' + sy + 'px';
                document.body.style.width = '100%';
            }

            function closeMenu() {
                // Read the origin from the currently-set clip-path so the circle
                // collapses back toward the same button that opened it.
                var cp = overlay.style.clipPath || overlay.style.webkitClipPath || '';
                var m  = cp.match(/at\s+([\d.]+)px\s+([\d.]+)px/);
                var ox = m ? m[1] : '40';
                var oy = m ? m[2] : '40';

                overlay.classList.remove('menu-open');
                overlay.classList.add('menu-closing');
                mobileMenuBtns.forEach(function (b) { b.classList.remove('menu-open'); });

                // Animate burst closed.
                setTransition('0.5s');
                setClipPath('circle(0% at ' + ox + 'px ' + oy + 'px)');

                // Restore scroll position (iOS-safe).
                var sy = parseInt(document.body.dataset.menuScrollY || '0', 10);
                document.body.style.position = '';
                document.body.style.top = '';
                document.body.style.width = '';
                window.scrollTo(0, sy);

                // Clean up once the transition ends. Safari sometimes skips
                // transitionend for clip-path, so add a timeout fallback
                // (slightly longer than the 0.5s close transition).
                var closeTimer = setTimeout(function () {
                    overlay.classList.remove('menu-closing');
                    overlay.style.display = 'none';
                    overlay.removeEventListener('transitionend', onEnd);
                    overlay.removeEventListener('webkitTransitionEnd', onEnd);
                }, 600);

                function onEnd(e) {
                    if (e.propertyName === 'clip-path' || e.propertyName === '-webkit-clip-path') {
                        clearTimeout(closeTimer);
                        overlay.classList.remove('menu-closing');
                        overlay.style.display = 'none';
                        overlay.removeEventListener('transitionend', onEnd);
                        overlay.removeEventListener('webkitTransitionEnd', onEnd);
                    }
                }
                overlay.addEventListener('transitionend', onEnd);
                overlay.addEventListener('webkitTransitionEnd', onEnd);
            }

            mobileMenuBtns.forEach(function (btn) {
                btn.addEventListener('click', function () {
                    if (overlay.classList.contains('menu-open')) {
                        closeMenu();
                    } else {
                        openMenu(btn);
                    }
                });
            });

            overlay.querySelectorAll('a').forEach(function (link) {
                link.addEventListener('click', closeMenu);
            });
        });

        {% if scrollCompactNav %}
        (function () {
            var navMain    = document.getElementById('nav-main');
            var navCompact = document.getElementById('nav-compact');
            var THRESHOLD  = 80;

            window.addEventListener('scroll', function () {
                if (window.scrollY > THRESHOLD) {
                    navMain.classList.remove('opacity-100', 'translate-y-0');
                    navMain.classList.add('opacity-0', '-translate-y-full', 'pointer-events-none');

                    navCompact.classList.remove('opacity-0', '-translate-y-full', 'pointer-events-none');
                    navCompact.classList.add('opacity-100', 'translate-y-0');
                } else {
                    navCompact.classList.remove('opacity-100', 'translate-y-0');
                    navCompact.classList.add('opacity-0', '-translate-y-full', 'pointer-events-none');

                    navMain.classList.remove('opacity-0', '-translate-y-full', 'pointer-events-none');
                    navMain.classList.add('opacity-100', 'translate-y-0');
                }
            });
        })();
        {% endif %}
    </script>
</body>
</html>
